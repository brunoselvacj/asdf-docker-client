#!/usr/bin/env bash

set -euo pipefail

# shellcheck source=/dev/null
source "$(dirname "$0")/utils.sh"

install_docker_client() {
  local version=$1
  local download_path=$2

  local platform
  platform="$(get_platform)"
  local arch
  arch="$(get_arch)"

  local download_url="https://download.docker.com/${platform}/static/stable/${arch}/docker-${version}.tgz"
  local tmp_download_dir
  tmp_download_dir=$(mktemp -d -t docker_client_tmp_XXXXXX)

  echo "Downloading Docker client from ${download_url}"
  curl -sSL "$download_url" -o "${tmp_download_dir}/docker.tgz"

  mkdir -p "$download_path"
  tar -xzf "${tmp_download_dir}/docker.tgz" -C "$download_path" --strip-components=1 docker/docker

  rm -rf "${tmp_download_dir}"
}

install_docker_client "$ASDF_DOWNLOAD_VERSION" "$ASDF_DOWNLOAD_PATH"
