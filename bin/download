#!/usr/bin/env bash

set -euo pipefail

# shellcheck source=/dev/null
source "$(dirname "$0")/utils.sh"

mkdir -p "$ASDF_DOWNLOAD_PATH"

download_docker() {
  local version=$1
  local download_path=$2
  local tmp_download_dir
  tmp_download_dir=$(mktemp -d -t docker_client_tmp_XXXXXX)
  local platform
  platform="$(get_platform)"
  local arch
  arch="$(get_arch)"

  local download_url="https://download.docker.com/${platform}/static/stable/${arch}/docker-${version}.tgz"

  echo "∗ Downloading Docker client version ${version}..."
  curl -sSL "$download_url" -o "${tmp_download_dir}/docker.tgz"

  echo "∗ Extracting Docker client..."
  tar -xzf "${tmp_download_dir}/docker.tgz" -C "$download_path" docker/docker

  rm -rf "${tmp_download_dir}"
}

download_docker "$ASDF_DOWNLOAD_VERSION" "$ASDF_DOWNLOAD_PATH"
