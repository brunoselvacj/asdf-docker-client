#!/usr/bin/env bash

set -euo pipefail

# Fetch all Docker releases from GitHub API
releases_path=https://api.github.com/repos/docker/cli/releases
cmd="curl -s"
if [ -n "${GITHUB_API_TOKEN:-}" ]; then
  cmd="$cmd -H 'Authorization: token $GITHUB_API_TOKEN'"
fi

# Process JSON with sed and sort versions
versions=$(eval "$cmd $releases_path" | grep -oE "tag_name\": *\"v[0-9]+\.[0-9]+\.[0-9]+\"" | sed 's/tag_name\": *\"v//;s/\"//' | sort -t. -k 1,1n -k 2,2n -k 3,3n)

# Output the versions
echo "$versions"
